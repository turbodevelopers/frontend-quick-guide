# Верстка на Jade

Если вы хотите верстать на Jade, не забудьте поставить соответствующие npm пакеты из `templates/package.json` (см. [Разворачивание проекта](deployment.md)) и настроить `gulp-config.js` (см. [Сборка проекта](build.md)).

Все исходники лежат в `templates/src/jade/`.

```
jade/                    # Файлы для Jade
    ├── blocks/          # Куски кода, подключаемые через обычный include
    ├── modules/         # Куски кода, подключаемые через специальный миксин, в который можно пробрасывать переменные
    ├── pages/           # Страницы проекта
    ├── BODY.tpl.jade    # Точка входа для страниц
    └── data.json        # Данные для шаблонизации
```

Все страницы `templates/src/jade/pages/*.jade` компилируются в `templates/pages/*.php`. 

Точка входа `templates/src/jade/BODY.tpl.jade` компилируется в `templates/BODY.tpl.php`. 

Таким образом, сохраняется дефолтная структура проекта, как если бы мы не подключали Jade, а писали сразу на PHP (см. [Верстка на PHP](php.md)). Это сделано в целях удобства и унификации сборки. При таком подходе не нужно переписывать роутер и прочие скрипты.

Папки `jade/block/` и `jade/modules/` являются аналогами папки `components/` для PHP. Туда кладутся куски кода, которые встречаются более, чем на одной странице, но между ними есть отличия.

## Блоки

Куски кода из `jade/block/` для простоты будем называть блоками. Блоки подключаются в других файлах через обычный `include`. По умолчанию в папке уже лежат:

```
footer.jade - разметка для футера
head.jade - разметка для тега <head/>
header.jade - разметка для хедера
```

## Модули

Куски кода из `jade/modules/` для простоты будем называть модулями. Киллерфича модулей в том, что при вызове в них можно передавать данные, что бывает полезно для шаблонизации. В результате этого работа с ними может показаться чуть сложнее, но ровно до первого применения. Из коробки присутствуют следующие модули:

```
define_view.jade - модуль для определения Backbone View страницы
svg.jade - модуль для подключения Symbol SVG спрайта
```

### Файл `_modules.jade`

Внутри `jade/modules/` находится специальный файл `_modules.jade`. Это скелет модулей. Он не подлежит ручному редактированию и автоматически обновляется сборщиком при добавлении в папку нового модуля. Этот файл содержит миксин, в который при вызове можно пробросить модуль с данными. 

Из коробки `_modules.jade` выглядит так:

```jade
- var MODULE = {}
- MODULE.DEFINE_VIEW = "define_view"    //- Модуль define_view.jade
- MODULE.SVG = "svg"                    //- Модуль svg.jade
mixin module(name,data)                 //- Миксин для работы с модулями
	- data = data || {}
	if (name=="define_view")
		include define_view
		+define_view(data)&attributes(data&&data.attrs||attributes)
			if(block)
				block
	if (name=="svg")
		include svg
		+svg(data)&attributes(data&&data.attrs||attributes)
			if(block)
				block
```

### Структура модуля

Любой модуль представляет собой миксин, в который можно передать объект с данными. Данные можно определять прямо внутри модуля. Например, `define_view.jade` базово выглядит так:

```jade
mixin define_view(data)
    - data = data || {}
    - title = data.title || ''    //- Заголовок для тега <title/>
    - id = data.id || 0           //- ID страницы
    - view = data.view || ''      //- Backbone View, привязанный к странице

    | <?
    | define('PAGE_TITLE','#{title}');
    | define('PAGE_SECTION_ID','#{id}');
    | define('PAGE_JS_VIEW','#{view}');
    | ?>
```

### Файл `data.json`

Определение данных внутри модуля подходит для служебных целей (как, например, в модуле `define_view.jade`). Однако, контент сайта лучше хранить в отдельном файле - `jade/data.json`. Предположим, нам нужно вывести на сайте небольшое меню из трех пунктов. Сначала опишем наши данные в `data.json`:

```json
{
"menu": [
      {
        "title": "Создай свой Tucson",
        "text": "Ваш автомобиль в 3 клика"
      },
      {
        "title": "Скачать брошюру",
        "text": "Узнай больше"
      },
      {
        "title": "Тест-драйв",
        "text": "Моментальная заявка в удобное для вас время"
      }
    ]
}
```

Затем создадим модуль `menu.jade` и выведем данные в цикле:
```jade
mixin menu(data)
    - data = data || {}
    ul
        each item in menu.list
            li
                h4!=item.title
                p!=item.text

                    
```

### Вызов модуля

В `_modules.jade` все модули кладутся в объект `MODULE`. На примере выше уже есть модули `MODULE.DEFINE_VIEW` и `MODULE.SVG` (поскольку в `jade/modules/` есть соответствующие файлы). Для подключения модуля используется миксин `module`, в который передаются 2 аргумента: имя модуля и опциональный объект с данными. Перед вызовом модуля обязательно нужно подключить `_modules.jade`.

Например, базово вызов `MODULE.DEFINE_VIEW` выглядит так:

```jade
include ../modules/_modules
+module(MODULE.DEFINE_VIEW, {title: 'Главная страница', id: 0, view: 'Index'})
```

## Страницы

Страницы сайта (index, news, contatcs и т.п.) кладутся в `jade/pages/`. Под страницей подразумевается кусок сайта между хедером и футером. Страницы могут включать в себя как модули, так и уникальный код.

По умолчанию в проекте уже лежит главная страница `index.jade`. Рассмотрим базовую структуру страниц на ее примере:

```jade
include ../modules/_modules
//- Определение Backbone View и ряда других параметров страницы
+module(MODULE.DEFINE_VIEW, {title: 'Главная страница', id: 0, view: 'Index'})

block content
    //- Корневой элемент для привязки Backbone View
    .page.page--index(data-view!='<?=PAGE_JS_VIEW?>') 
        //- ...
```

Внутри каждой страницы нужно обязательно вызывать модуль `MODULE.DEFINE_VIEW` и определять Backbone View в атрибуте `data-view`. Backbone View используется для роутинга и содержит весь js, который иcпользуется на странице. Подробнее об этом написано в разделе [Скрипты](js.md).

Страницу достаточно просто создать. Не нужно ее никуда инклудить, т.к. все страницы автоматически компилируются в PHP файлы.

## Точка входа

В корне `jade/` лежит файл `BODY.tpl.jade`. В нем подключаются все блоки, перечисленные выше, а также находится точка входа для всех страниц сайта (PHP переменная `<?=$CONTENT?>`). Поэтому страницы сюда инклудить не нужно, они будут автоматически подхватываться переменной `<?=$CONTENT?>` после компиляции в PHP.

## Итого

Чтобы создать страницу новостей, нужно в папке `jade/pages/` создать файл `news.jade` (не забудьте внутри вызвать `MODULE.DEFINE_VIEW` и определить Backbone View). Он автоматически скомпилируется в `templates/pages/news.php` и станет доступен по адресу `http://127.0.0.1/<имя_проекта>/news`.

Если вы определились, что будете верстать на Jade, то можете удалить папку `templates/components/` с PHP компонентами, т.к. при верстке на Jade они не понадобятся.